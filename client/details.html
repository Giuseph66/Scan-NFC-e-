<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFC-e Scan - Detalhes</title>
<link rel="stylesheet" href="styles/details.css">
<link rel="stylesheet" href="styles/notifications.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Detalhes da NFC-e</h1>
            <nav>
                <a href="history.html">&larr; Voltar ao Hist√≥rico</a> |
                <a href="productSearch.html">Buscar por Produto</a> 
            </nav>
        </header>

        <main>
            <section class="details-section">
                <div id="loadingMessage">Carregando detalhes...</div>
                <div id="errorMessage" style="display:none; color: red;"></div>
                
                <div id="notaDetails" style="display:none;">
                    <h2>Informa√ß√µes Gerais</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>ID:</label>
                            <span id="detailId">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Chave:</label>
                            <span id="detailChave">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Vers√£o QR:</label>
                            <span id="detailVersao">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Ambiente:</label>
                            <span id="detailAmbiente">-</span>
                        </div>
                        <div class="detail-item">
                            <label>cIdToken:</label>
                            <span id="detailCIdToken">-</span>
                        </div>
                        <div class="detail-item">
                            <label>vSig:</label>
                            <span id="detailVSig">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Data de Leitura:</label>
                            <span id="detailCreatedAt">-</span>
                        </div>
                        <div class="detail-item full-width">
                            <button id="viewSefazBtn" class="sefaz-button" style="display: none;">
                                üåê Ver Nota na SEFAZ
                            </button>
                        </div>
                    </div>

                    <h2>Emitente</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>CNPJ:</label>
                            <span id="detailCnpjEmitente">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Raz√£o Social:</label>
                            <span id="detailNomeEmitente">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Nome Fantasia:</label>
                            <span id="detailNomeFantasia">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Inscri√ß√£o Estadual:</label>
                            <span id="detailIeEmitente">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Situa√ß√£o Cadastral:</label>
                            <span id="detailSituacaoCadastral">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Data de Abertura:</label>
                            <span id="detailDataAbertura">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Capital Social:</label>
                            <span id="detailCapitalSocial">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Natureza Jur√≠dica:</label>
                            <span id="detailNaturezaJuridica">-</span>
                        </div>
                    </div>

                    <h2>Endere√ßo</h2>
                    <div class="details-grid">
                        <div class="detail-item full-width">
                            <label>Endere√ßo Completo:</label>
                            <span id="detailEndereco">-</span>
                        </div>
                        <div class="detail-item">
                            <label>CEP:</label>
                            <span id="detailCep">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Munic√≠pio:</label>
                            <span id="detailMunicipio">-</span>
                        </div>
                        <div class="detail-item">
                            <label>UF:</label>
                            <span id="detailUf">-</span>
                        </div>
                    </div>

                    <h2>Contato</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>Telefone:</label>
                            <span id="detailTelefone">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Email:</label>
                            <span id="detailEmail">-</span>
                        </div>
                    </div>

                    <h2>Itens</h2>
                    
                    <div class="search-items-container">
                        <input type="text" id="searchItemsInput" placeholder="üîç Buscar item na tabela..." />
                        <span id="searchItemsCounter" class="search-counter"></span>
                    </div>
                    
                    <div class="action-buttons" style="justify-content: flex-end; margin-bottom: 10px; gap: 10px;">
                        <button id="padronizarItensBtn" class="rebusca-button">ü§ñ Padronizar Itens (IA)</button>
                        <button id="toggleStdBtn" class="sefaz-button" style="display:none;">Mostrar itens padronizados</button>
                    </div>
                    <div class="table-container">
                        <table id="itensDetailTable">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Qtde</th>
                                    <th>Un</th>
                                    <th>Unit√°rio</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Itens ser√£o preenchidos aqui -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Bot√£o de rebusca quando n√£o h√° itens -->
                    <div id="rebuscaSection" class="rebusca-section" style="display: none;">
                        <div class="rebusca-message">
                            <p>‚ö†Ô∏è Nenhum item foi encontrado para esta nota.</p>
                            <p>Isso pode indicar um problema durante o salvamento inicial.</p>
                        </div>
                        <button id="rebuscaBtn" class="rebusca-button">
                            üîÑ Rebuscar Itens da Nota
                        </button>
                        <div id="rebuscaStatus" class="rebusca-status" style="display: none;"></div>
                    </div>

                    <div class="total-section">
                        <div class="total-container">
                            <div class="total-label">Total da Nota:</div>
                            <div class="total-value" id="totalNota">R$ 0,00</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 NFC-e Scan App</p>
        </footer>
    </div>

    <script src="js/notifications.js"></script>
    <script src="js/notasTracker.js"></script>
    <script src="details.js"></script>

</body>
</html>